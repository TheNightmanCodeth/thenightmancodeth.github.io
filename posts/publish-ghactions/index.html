<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Joe's Blog"/><link rel="canonical" href="https://www.jdiggity.me/posts/publish-ghactions"/><meta name="twitter:url" content="https://www.jdiggity.me/posts/publish-ghactions"/><meta name="og:url" content="https://www.jdiggity.me/posts/publish-ghactions"/><title>Using GitHub actions to deploy Publish sites to GitHub Pages | Joe's Blog</title><meta name="twitter:title" content="Using GitHub actions to deploy Publish sites to GitHub Pages | Joe's Blog"/><meta name="og:title" content="Using GitHub actions to deploy Publish sites to GitHub Pages | Joe's Blog"/><meta name="description" content="How to use GitHub Actions to deploy a static site built with Publish to GitHub Pages"/><meta name="twitter:description" content="How to use GitHub Actions to deploy a static site built with Publish to GitHub Pages"/><meta name="og:description" content="How to use GitHub Actions to deploy a static site built with Publish to GitHub Pages"/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Joe's Blog"/></head><body class="item-page"><header><div class="wrapper"><a href="/" class="site-name">Joe's Blog</a><nav><ul><li><a href="/home">Home</a></li><li><a href="/posts" class="selected">My posts</a></li><li><a href="/about">About</a></li></ul></nav></div></header><div class="wrapper"><article><div class="content"><h1>Using GitHub actions to deploy Publish sites to GitHub Pages</h1><p>I just spent a good few weeks looking for a good static site generator and in my journey found <a href="https://github.com/JohnSundell/Publish">Publish</a>. While this article isn‚Äôt about that, I highly recommend using Publish if you‚Äôre a Swift developer looking for a good static site generator!</p><p>While <code>Publish</code> comes with a built-in deployment function that works with GH Pages, <em>I</em> couldn't get it to work. It looks like it really only works if you‚Äôre deploying to a separate repository. Even then, a lot of us wish to automatically trigger a publish on each new blog post or git commit. I spent some time yesterday messing with GitHub Actions and put together a build script that can do just that.</p><h2>The Process</h2><p>I started off trying to simply spin up a macOS machine, cloning my repo, installing the <code>publish</code> command line tool from homebrew, generating the HTML and pushing that to my GitHub Pages branch.</p><p>This proved to be a bit of a hassle. GitHub actions uses a version of macOS that is too old to work with the publish command line tool that is available through homebrew.</p><p>‚ÄúOkay,‚Äù I thought. ‚ÄúI‚Äôll just build the command line tool from the source code.‚Äù Well, that didn‚Äôt work either. I was missing some swift concurrency libraries on the worker machine. That meant, I assume, the version of Swift on the GH Actions build machine was too old ‚òπÔ∏è.</p><p>At this point I considered giving up, until I remembered Swift is cross platform! üéâüéâ</p><p>I set the runner to use <code>ubuntu-latest</code> instead of <code>macOS-latest</code> and got to thinking.</p><p>On Ubuntu the steps would be a bit different. First and foremost I‚Äôd need to install Swift. Luckily there exists an action on the GitHub Actions Marketplace called <a href="https://github.com/marketplace/actions/install-swift-on-linux"><code>Install Swift on Linux</code></a> which does just that: installs Swift on a Linux worker on Github Actions! Lucky day!</p><p>After Swift was installed I‚Äôd need to either get the <code>publish</code> command line tool building on Linux or figure out a way to build the project some other way. ü§û</p><p>Luckily (spoiler alert) the <code>publish</code> tool compiled and installed just fine on Ubuntu.</p><p>The last step was to push the resulting <code>Output</code> directory to my GitHub pages branch on my repo. Luckily there exists an awesome action on the GitHub Marketplace that makes doing that extremely easy. It‚Äôs called <a href="https://github.com/marketplace/actions/deploy-to-github-pages">Deploy to GitHub Pages</a> and it works like a charm!</p><p>Now that we‚Äôve outlined the approach let‚Äôs get to making the workflow!</p><h2>Before we start...</h2><p>This will <em>not</em> be a GitHub Pages tutorial. In order to follow along here, you should already have GitHub Pages setup using one of your repos. You can check out the <a href="https://docs.github.com/en/pages/getting-started-with-github-pages/creating-a-github-pages-site">Creating a GitHub Pages Site</a> article for more info. Basically you'll create a new repository, name it <code>&lt;yourgithubusername&gt;.github.io</code> and configure the settings there.</p><h2>Creating the Workflow</h2><p>To get started creating the workflow we‚Äôll open up a terminal and <code>cd</code> into our project‚Äôs root directory.</p><p>Once there, we create the directory <code>.github/workflows</code> and create a new file inside there called <code>main.yml</code>.</p><pre><code><span class="keyword">mkdir</span> <span class="type">-p</span> <span class="string">.github/workflows</span><br /><span class="keyword">touch</span> <span class="string">.github/workflows/main.yml</span></code></pre><p>Now we open up our favorite text editor and start configuring our workflow!</p><pre><code><span class="keyword">nvim</span> <span class="string">.github/workflows/main.yml</span></code></pre><p>First, we name our workflow:</p><pre><code><span class="type">name</span>: <span class="string">Deploy to GitHub Pages</span></code></pre><p>Next, we trigger the workflow when the branch with our source code receives a push. In my case, the source code for my blog is located on the <code>Publish</code> branch.</p><pre><code><span class="type">on</span>:<br />  <span class="type">push</span>:<br />    <span class="type">branches</span>: [ <span class="string">‚ÄúPublish‚Äù</span> ]</code></pre><p>Finally we begin the actual workflow. First we tell the worker to use <code>ubuntu-latest</code> and use the marketplace action mentioned above to install the latest version of <code>Swift</code>.</p><pre><code><span class="type">jobs</span>:<br />  <span class="type">build</span>:<br />    <span class="type">runs-on</span>: <span class="string">ubuntu-latest</span><br />    <span class="type">steps</span>:<br />      - <span class="type">name</span>: <span class="string">Install Swift</span><br />        <span class="type">uses</span>: <span class="string">sersoft-gmbh/swifty-linux-action@v1</span><br />        <span class="type">with</span>:<br />          <span class="type">release-version</span>: <span class="string">5.6.2</span></code></pre><p>With our worker configured and swift installed we can move on to the next step: installing the <code>publish</code> command line tool.</p><p>Inside of the <code>steps</code> section we add the following:</p><pre><code>- <span class="type">name</span>: <span class="string">Install Publish</span><br />  <span class="type">run</span>: <span class="keyword">|</span><br /><span class="string">    git clone https://github.com/JohnSundell/Publish.git<br />    cd Publish<br />    make</span></code></pre><p>Now we can pull our repo to the worker and generate our static website!</p><pre><code>- <span class="type">uses</span>: <span class="string">actions/checkout@v3</span><br /><br />- <span class="type">name</span>: <span class="string">Generate site</span>
  <span class="type">run</span>: <span class="keyword">|</span><br /><span class="string">    cd $GITHUB_WORKSPACE/blog/<br />    publish generate</span></code></pre><p>A few things are going on here. First we use the <code>checkout</code> action from GitHub that pulls our repo from the branch that this <code>main.yml</code> is located on. The <code>checkout</code> action pulls the source code to <code>$GITHUB_WORKSPACE</code>, so we <code>cd</code> to that path. In my case, the source code is located inside of a subdirectory called <code>blog</code>, so I change directories to <code>$GITHUB_WORKSPACE/blog</code>. Once inside that directory we call <code>publish generate</code> to generate our static website.</p><p>Lastly we‚Äôll use the <code>github-pages-deploy-action</code> to deploy our static site to our GitHub Pages branch!</p><pre><code><span class="keyword">-</span> <span class="type">name</span>: <span class="string">Deploy site</span>
  <span class="type">uses</span>: <span class="string">JamesIves/github-pages-deploy-action@v4</span>
    <span class="type">with</span>:
      <span class="type">branch</span>: <span class="string">master</span>
      <span class="type">folder</span>: <span class="string">blog/Output</span>
</code></pre><p>And just like that, our workflow is complete! In the last step we tell the <code>github-pages-deploy-action</code> which branch to deploy to, you might set this to <code>gh-pages</code> depending on your configuration. Then we tell it where our static site is located. In my case it‚Äôs located in the <code>Output</code> folder inside of the <code>blog</code> folder inside of the root of my repo. Yours might just be <code>folder: Output</code>.</p><p>After all of that, your <code>.github/workflows/main.yml</code> file should look something like this:</p><pre><code><span class="type">name</span>: <span class="string">Deploy to GHPages</span>

<span class="type">on</span>:
  <span class="type">push</span>:
    <span class="type">branches</span>: <span class="keyword">[</span> <span class="string">"Publish"</span> <span class="keyword">]</span>

<span class="type">jobs</span>:
  <span class="type">build</span>:
    <span class="type">runs-on</span>: <span class="string">ubuntu-latest</span>
    <span class="type">steps</span>:
      <span class="keyword">-</span> <span class="type">name</span>: <span class="string">Install Swift</span>
        <span class="type">uses</span>: <span class="string">sersoft-gmbh/swifty-linux-action@v1</span>
        <span class="type">with</span>:
          <span class="type">release-version</span>: <span class="string">5.6.2</span>

      <span class="keyword">-</span> <span class="type">name</span>: <span class="string">Install Publish</span>
        <span class="type">run</span>: <span class="keyword">|</span>
          <span class="string">git clone https://github.com/JohnSundell/Publish.git
          cd Publish
          make</span>

      <span class="keyword">-</span> <span class="type">uses</span>: <span class="string">actions/checkout@v3</span>

      <span class="keyword">-</span> <span class="type">name</span>: <span class="string">Generate site</span>
        <span class="type">run</span>: <span class="keyword">|</span>
          <span class="string">cd $GITHUB_WORKSPACE/blog/
          publish generate</span>

      <span class="keyword">-</span> <span class="type">name</span>: <span class="string">Publish site</span>
        <span class="type">uses</span>: <span class="string">JamesIves/github-pages-deploy-action@v4</span>
        <span class="type">with</span>:
          <span class="type">branch</span>: <span class="string">master</span>
          <span class="type">folder</span>: <span class="string">blog/Output</span>
</code></pre><p>Now commit and push that file to your repo and go to the <code>actions</code> tab.</p><img src="/img/ghactions.png" alt="GitHub Actions"/></div><ul class="tag-list"><li><a href="/tags/swift">swift</a></li><li><a href="/tags/githubpages">github-pages</a></li><li><a href="/tags/publish">publish</a></li></ul></article></div><footer><p>Generated using <a href="https://github.com/johnsundell/publish">Publish</a></p><p><a href="/feed.rss">RSS feed</a></p></footer></body></html>